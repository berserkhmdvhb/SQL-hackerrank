(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6339],{33237:function(e,t,r){"use strict";r.d(t,{J:function(){return h}});var n,i="https://js.stripe.com/v3",a=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,s=function(){for(var e=document.querySelectorAll('script[src^="'.concat(i,'"]')),t=0;t<e.length;t++){var r=e[t];if(a.test(r.src))return r}return null},o=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",r=document.createElement("script");r.src="".concat(i).concat(t);var n=document.head||document.body;if(!n)throw Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return n.appendChild(r),r},l=function(e,t){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"2.4.0",startTime:t})},u=null,d=null,c=null,p=function(e,t,r){if(null===e)return null;var n=e.apply(void 0,t);return l(n,r),n},m=!1,x=function(){return n||(n=(null!==u?u:(u=new Promise(function(e,t){if("undefined"==typeof window||"undefined"==typeof document){e(null);return}if(window.Stripe,window.Stripe){e(window.Stripe);return}try{var r,n=s();n?n&&null!==c&&null!==d&&(n.removeEventListener("load",c),n.removeEventListener("error",d),null===(r=n.parentNode)||void 0===r||r.removeChild(n),n=o(null)):n=o(null),c=function(){window.Stripe?e(window.Stripe):t(Error("Stripe.js not available"))},d=function(){t(Error("Failed to load Stripe.js"))},n.addEventListener("load",c),n.addEventListener("error",d)}catch(e){t(e);return}})).catch(function(e){return u=null,Promise.reject(e)})).catch(function(e){return n=null,Promise.reject(e)}))};Promise.resolve().then(function(){return x()}).catch(function(e){m||console.warn(e)});var h=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];m=!0;var n=Date.now();return x().then(function(e){return p(e,t,n)})}},23229:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/premium",function(){return r(73538)}])},28424:function(e,t,r){"use strict";r.d(t,{QO:function(){return d},gZ:function(){return m},_K:function(){return f}});var n=r(28598),i=r(82684),a=r(49452),s=r(78239),o=r(14737),l=r(68337),u=r(50039),d=function(e){let t=t=>{let{isLoading:r,user:l}=(0,s.aF)(),{isOpen:d,onOpen:c,onClose:p}=(0,a.q)();return(0,i.useEffect)(()=>{r||l||c()},[l,r,c]),(0,n.jsx)(n.Fragment,{children:r?(0,n.jsx)(u.A,{children:(0,n.jsx)(o.aN,{})}):(0,n.jsx)(n.Fragment,{children:l?(0,n.jsx)(e,{...t}):(0,n.jsx)(o._A,{isModalOpen:d,onClose:p})})})};return t.displayName="WithAuth(".concat((0,l.lF)(e),")"),t},c=r(86105),p=r(34376),m=function(e){let t=t=>{let{user:r}=(0,s.aF)(),{push:a}=(0,p.useRouter)(),d=(0,l.jI)(r);return(0,i.useEffect)(()=>{r&&!d&&a(c.Z5.Pricing)},[r]),(0,n.jsx)(u.A,{children:d?(0,n.jsx)(e,{...t}):(0,n.jsx)(o.aN,{})})};return t.displayName="WithPremium(".concat((0,l.lF)(e),")"),t},x=r(91760);let h=(0,r(33237).J)(c.J0);var f=function(e){let t=t=>(0,n.jsx)(x.Elements,{stripe:h,children:(0,n.jsx)(e,{...t})});return t.displayName="WithStripe(".concat((0,l.lF)(e),")"),t}},73538:function(e,t,r){"use strict";r.r(t);var n=r(28598),i=r(82684),a=r(68739),s=r(68925),o=r.n(s),l=r(91760),u=r(49452),d=r(30746),c=r(29101),p=r(68908),m=r(35585),x=r(46171),h=r(51621),f=r(5764),j=r(53424),v=r(52154),y=r(93153),b=r(78239),_=r(17603),g=r(14737),w=r(86105),C=r(68337),S=r(28424),E=r(34376),I=r(10891),P=r.n(I);let F="Please contact support team.";t.default=(0,S.QO)((0,S.gZ)((0,S._K)(()=>{let{user:e}=(0,b.aF)(),t=(0,l.useStripe)(),r=(0,l.useElements)(),[{fetched:s,data:S},I]=(0,i.useState)({loading:!1,fetched:!1,data:null}),[{fetched:T,data:N},k]=(0,i.useState)({loading:!1,fetched:!1,data:null}),[A,L]=(0,i.useState)(null),[W,M]=(0,i.useState)(!1),[D,O]=(0,i.useState)(!1),[U,Y]=(0,i.useState)(null),[q,K]=(0,i.useState)(null),[Q,R]=(0,i.useState)(!1),{isOpen:X,onOpen:z,onClose:V}=(0,u.q)(),{push:J}=(0,E.useRouter)(),Z=null==N?void 0:N.subscriptionType,H=Z===w.CD.Monthly?"month":"year",$=(0,i.useMemo)(()=>({showIcon:!0,disabled:D,classes:{base:P().stripeInput,invalid:P().stripeInputInvalid,focus:P().stripeInputFocus}}),[D]),B=async()=>{O(!0);try{var n,i,a;if(!t||!r||!e){_.Yd.error("Error during updating customer card, customerId=".concat(null==e?void 0:e.customerId," userId=").concat(null==e?void 0:e.id)),Y(w.rQ),O(!1);return}let s=await t.createPaymentMethod({type:"card",card:r.getElement(l.CardElement)});if((null===(n=s.error)||void 0===n?void 0:n.message)||!(null===(i=s.paymentMethod)||void 0===i?void 0:i.id)){Y((null===(a=s.error)||void 0===a?void 0:a.message)||w.rQ),O(!1);return}let o=await _.te.updateUserPaymentMethod(s.paymentMethod.id);I(e=>({...e,data:o})),M(!1),O(!1),K(!0)}catch(e){O(!1),K(!1),Y(e.response.data.error||w.rQ),_.Yd.error(e)}},G=async()=>{if(!W){M(e=>!e);return}await B()},ee=()=>(null==N?void 0:N.status)===w.yh.PastDue?"orange.400":(null==N?void 0:N.status)===w.yh.Cancelled?"red.400":"green.400",et=(0,i.useCallback)(async()=>{if(!e)return;let t={fields:["id","amount","date","status","customer_id","subscription_type"],filter:{user_id:{_eq:e.id}},sort:"-date"};try{k(e=>({...e,loading:!0})),I(e=>({...e,loading:!0}));let[r]=await _.FF.getLastSubscription({filter:{user_id:{_eq:e.id}}}),n=await _.te.getPayments(t),i=await _.te.getUserCard();r||k({loading:!1,fetched:!0,data:null}),k({loading:!1,fetched:!0,data:r}),R(!1),L(n),I({loading:!1,fetched:!0,data:i})}catch(e){I(e=>({...e,loading:!1,fetched:!0})),k({loading:!1,fetched:!0,data:null}),R(!1),_.Yd.error(e)}},[e]);(0,i.useEffect)(()=>{et()},[et]);let er=async()=>{try{R(!0),V(),await _.V0.post((0,C.Td)(w.xr.CancelSubscription)),localStorage.setItem("subscriptionEndingDate",null==N?void 0:N.periodEndsAt),J(w.Z5.Home)}catch(e){console.log(e)}};return(0,n.jsxs)(d.W,{maxWidth:"1100px",py:"10px",children:[(0,n.jsx)(g.em,{subscriptionId:null==N?void 0:N.id,userEmail:null==e?void 0:e.email,isModalOpen:X,markSubscriptionForCancellation:er,closeConfirmationModal:V}),T&&N&&(0,n.jsxs)(c.X,{as:"h1",mt:"20px",p:"20px",backgroundColor:ee(),borderRadius:"8px",color:"white",children:["Your subscription is ",w.KC[N.status]]}),(0,n.jsxs)(p.xu,{className:P().wrapper,children:[(0,n.jsxs)(p.xu,{children:[(0,n.jsxs)(m.k,{justifyContent:"space-between",children:[(0,n.jsx)(c.X,{as:"h4",className:P().tableTitle,children:"Current plan"}),N&&(null==N?void 0:N.status)!==w.yh.Cancelled&&(null==N?void 0:N.subscriptionType)!==w.CD.Lifetime&&T&&!Q&&(0,n.jsx)(x.x,{textDecoration:"underline",onClick:z,cursor:"pointer",children:"Cancel Subscription"})]}),(0,n.jsx)(h.i,{mt:"4px",mb:"6px",borderColor:"gray.400",w:"100%"}),T?T&&N?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(m.k,{mb:"18px",maxW:"576px",justifyContent:"space-between",alignItems:"center",textTransform:"capitalize",children:[(0,n.jsxs)(x.x,{children:[Z," subscription plan"]}),(0,n.jsx)(x.x,{backgroundColor:ee(),color:"white",ml:"10px",h:"32px",px:"10px",py:"4px",borderRadius:"10px",textTransform:"capitalize",children:w.KC[N.status]})]}),N.subscriptionType!==w.CD.Lifetime&&(0,n.jsxs)(x.x,{children:["$",(0,C.nh)(null==N?void 0:N.amount)," per ",H]}),(0,n.jsx)(x.x,{mt:"20px",children:N&&Z!==w.CD.Lifetime&&N.periodEndsAt?N.status===w.yh.Cancelled&&N.cancelAt?"Your subscription ".concat((0,C.sv)(N.periodEndsAt,Z)?"will end":"has ended"," on ").concat(a.ou.fromISO(null==N?void 0:N.cancelAt).toLocaleString(a.ou.DATE_FULL)):N.status===w.yh.PastDue&&N.nextPaymentAttempt?"Subscription payment failure, next attempt on ".concat(a.ou.fromISO(N.nextPaymentAttempt).toLocaleString(a.ou.DATE_FULL)):"Next payment due on ".concat(a.ou.fromISO(null==N?void 0:N.periodEndsAt).toLocaleString(a.ou.DATE_FULL)):null})]}):(0,n.jsxs)(x.x,{children:["Subscription was not found. ",F]}):(0,n.jsx)(g.aN,{height:"100px"})]}),(0,n.jsxs)(p.xu,{mt:"40px",children:[(0,n.jsx)(c.X,{as:"h4",className:P().tableTitle,children:"Payment method"}),(0,n.jsx)(h.i,{mt:"4px",mb:"6px",borderColor:"gray.400",w:"100%"}),s?S?(0,n.jsxs)(p.xu,{className:o()(P().paymentMethodWrapper,{[P().isCardInputVisible]:W}),children:[W?(0,n.jsx)(l.CardElement,{options:$,onChange:()=>{Y(null)}}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(m.k,{children:[(0,n.jsx)(x.x,{textTransform:"uppercase",children:null==S?void 0:S.brand}),(0,n.jsxs)(x.x,{ml:"14px",children:["****",null==S?void 0:S.lastFour]})]}),(0,n.jsxs)(x.x,{my:"10px",children:["Expires: ",null==S?void 0:S.expMonth,"/",null==S?void 0:S.expYear]})]}),W&&(0,n.jsx)(f.z,{h:"50px",colorScheme:"red",variant:"outline",isDisabled:D,onClick:()=>{M(!1),Y(null)},children:"Cancel"}),S&&(0,n.jsx)(f.z,{h:"50px",colorScheme:q?"green":"blue",variant:"outline",isLoading:D,isDisabled:!!q||D,onClick:G,children:q?"Updated succeeded":"Update"}),U&&(0,n.jsx)(j.M,{in:!!U,className:P().errorWrapper,children:(0,n.jsxs)(v.M,{minH:"50px",backgroundColor:"red.100",px:"10px",py:"4px",mt:"8px",borderRadius:"6px",children:[(0,n.jsx)(y.a,{mr:"10px",fontSize:"24px"}),U]})})]}):(0,n.jsxs)(x.x,{children:["Your card was not found. ",F]}):(0,n.jsx)(g.aN,{height:"30px"})]}),(0,n.jsxs)(p.xu,{mt:"40px",children:[(0,n.jsx)(c.X,{as:"h4",className:P().tableTitle,children:"All invoices"}),(0,n.jsx)(h.i,{mt:"4px",mb:"6px",borderColor:"gray.400",w:"100%"}),A&&A.map(e=>{let t=e.status===C.UY.Succeeded;return(0,n.jsxs)(m.k,{my:"10px",justifyContent:"space-between",alignItems:"center",children:[(0,n.jsx)(x.x,{children:a.ou.fromISO(e.date).toFormat("MM/dd/yyyy")}),(0,n.jsxs)(x.x,{mx:"14px",children:["$",(0,C.nh)(e.amount)]}),(0,n.jsx)(x.x,{px:"10px",py:"4px",borderRadius:"8px",color:"white",backgroundColor:t?"blue.300":"red.300",children:t?"Paid":"Failed"})]},e.id)})]})]})]})})))},10891:function(e){e.exports={wrapper:"Premium_wrapper__0_TK9",tableTitle:"Premium_tableTitle__23HKJ",isCardInputVisible:"Premium_isCardInputVisible__5CBxe",stripeInput:"Premium_stripeInput__PIF5r",stripeInputInvalid:"Premium_stripeInputInvalid__OrqkQ",stripeInputFocus:"Premium_stripeInputFocus__h6W8K",cardInputWrapper:"Premium_cardInputWrapper__ds0tT",paymentMethodWrapper:"Premium_paymentMethodWrapper__nTmWs",errorWrapper:"Premium_errorWrapper__8V1nx"}}},function(e){e.O(0,[1265,3662,544,4737,9774,2888,179],function(){return e(e.s=23229)}),_N_E=e.O()}]);
//# sourceMappingURL=premium-dc480387a2f0cf78.js.map